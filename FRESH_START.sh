#!/bin/bash
# –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é —á–∏—Å—Ç—É—é –≤–µ—Ç–∫—É –±–µ–∑ –∏—Å—Ç–æ—Ä–∏–∏ (–ø—Ä–æ—â–µ —á–µ–º filter-branch)
# –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç –Ω–æ–≤—É—é –∏—Å—Ç–æ—Ä–∏—é!

set -e

echo "üîÑ –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é —á–∏—Å—Ç—É—é –≤–µ—Ç–∫—É –±–µ–∑ –∏—Å—Ç–æ—Ä–∏–∏ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤..."

# –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é orphan –≤–µ—Ç–∫—É (–±–µ–∑ —Ä–æ–¥–∏—Ç–µ–ª–µ–π)
git checkout --orphan fresh-main

# –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ —Ñ–∞–π–ª—ã (–∫—Ä–æ–º–µ —Ç–µ—Ö —á—Ç–æ –≤ .gitignore)
git add .

# –î–µ–ª–∞–µ–º –ø–µ—Ä–≤—ã–π –∫–æ–º–º–∏—Ç
git commit -m "Initial commit - clean history without release files"

# –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ–º —Å—Ç–∞—Ä—É—é –≤–µ—Ç–∫—É (–Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è)
git branch -m main old-main-with-history 2>/dev/null || true

# –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ–º –Ω–æ–≤—É—é –≤–µ—Ç–∫—É –≤ main
git branch -m fresh-main main

echo ""
echo "‚úÖ –ù–æ–≤–∞—è —á–∏—Å—Ç–∞—è –≤–µ—Ç–∫–∞ —Å–æ–∑–¥–∞–Ω–∞!"
echo ""
echo "üì§ –¢–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ force push:"
echo "   git push -u origin main --force"
echo ""
echo "‚ö†Ô∏è  –≠—Ç–æ –ø–µ—Ä–µ–∑–∞–ø–∏—à–µ—Ç –≤–µ—Ç–∫—É main –Ω–∞ GitHub!"
echo "   –°—Ç–∞—Ä–∞—è –≤–µ—Ç–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ –∫–∞–∫ 'old-main-with-history'"
