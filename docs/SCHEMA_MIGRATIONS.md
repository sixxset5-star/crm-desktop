# üîÑ –ú–∏–≥—Ä–∞—Ü–∏–∏ —Å—Ö–µ–º—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## –ö–∞–∫ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –≤ Supabase

–ö–æ–≥–¥–∞ –≤—ã –¥–æ–±–∞–≤–ª—è–µ—Ç–µ –Ω–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –≤ –ª–æ–∫–∞–ª—å–Ω—É—é SQLite –±–∞–∑—É, –∏—Ö –Ω—É–∂–Ω–æ —Ç–∞–∫–∂–µ –¥–æ–±–∞–≤–∏—Ç—å –≤ Supabase.

---

## –ú–µ—Ç–æ–¥ 1: –í—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ SQL Editor (–±—ã—Å—Ç—Ä–æ –¥–ª—è –Ω–µ–±–æ–ª—å—à–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π)

1. –û—Ç–∫—Ä–æ–π—Ç–µ **Supabase Dashboard** ‚Üí **SQL Editor**
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–ª–æ–Ω–∫–∏:

```sql
-- –ü—Ä–∏–º–µ—Ä: –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–æ–Ω–∫—É contractor_id –≤ —Ç–∞–±–ª–∏—Ü—É tasks
ALTER TABLE tasks ADD COLUMN contractor_id TEXT;

-- –ü—Ä–∏–º–µ—Ä: –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–æ–Ω–∫—É is_active –≤ —Ç–∞–±–ª–∏—Ü—É contractors
ALTER TABLE contractors ADD COLUMN is_active INTEGER DEFAULT 1;
```

3. –û–±–Ω–æ–≤–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö (`scripts/migrate-to-supabase.mjs`), —á—Ç–æ–±—ã –æ–Ω –Ω–µ –∏—Å–∫–ª—é—á–∞–ª –Ω–æ–≤—É—é –∫–æ–ª–æ–Ω–∫—É

---

## –ú–µ—Ç–æ–¥ 2: –ß–µ—Ä–µ–∑ —Ñ–∞–π–ª—ã –º–∏–≥—Ä–∞—Ü–∏–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

### –®–∞–≥ 1: –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –≤ `supabase/migrations/` —Å –∏–º–µ–Ω–µ–º –≤ —Ñ–æ—Ä–º–∞—Ç–µ `002_add_new_columns.sql`:

```sql
-- Migration: Add new columns
-- Date: 2024-12-14

-- –î–æ–±–∞–≤–∏—Ç—å contractor_id –≤ tasks
ALTER TABLE tasks ADD COLUMN IF NOT EXISTS contractor_id TEXT;

-- –î–æ–±–∞–≤–∏—Ç—å is_active –≤ contractors (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
ALTER TABLE contractors ADD COLUMN IF NOT EXISTS is_active INTEGER DEFAULT 1;

-- –ò —Ç.–¥.
```

### –®–∞–≥ 2: –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é –≤ Supabase

1. –û—Ç–∫—Ä–æ–π—Ç–µ **Supabase Dashboard** ‚Üí **SQL Editor**
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ –º–∏–≥—Ä–∞—Ü–∏–∏
3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL

**–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Supabase CLI** (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω):

```bash
supabase db push
```

---

## –ú–µ—Ç–æ–¥ 3: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ö–µ–º (–ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π)

–ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π:
1. –ß–∏—Ç–∞–µ—Ç —Å—Ö–µ–º—É SQLite
2. –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å —Å—Ö–µ–º–æ–π Supabase
3. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç SQL –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –∫–æ–ª–æ–Ω–æ–∫

**–ü—Ä–∏–º–µ—Ä —Å–∫—Ä–∏–ø—Ç–∞** (`scripts/sync-schema.mjs`):

```javascript
// 1. –ü–æ–ª—É—á–∏—Ç—å —Å—Ö–µ–º—É SQLite
const sqliteSchema = getSQLiteSchema();

// 2. –ü–æ–ª—É—á–∏—Ç—å —Å—Ö–µ–º—É Supabase —á–µ—Ä–µ–∑ API
const supabaseSchema = await getSupabaseSchema();

// 3. –°—Ä–∞–≤–Ω–∏—Ç—å –∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å ALTER TABLE –∫–æ–º–∞–Ω–¥—ã
const differences = compareSchemas(sqliteSchema, supabaseSchema);

// 4. –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
```

–≠—Ç–æ —Å–ª–æ–∂–Ω–µ–µ, –Ω–æ –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–∑–∂–µ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ.

---

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π –∫–æ–ª–æ–Ω–∫–∏ –≤ Supabase, –æ–±–Ω–æ–≤–∏—Ç–µ `scripts/migrate-to-supabase.mjs`:

1. **–ï—Å–ª–∏ –∫–æ–ª–æ–Ω–∫–∞ –¥–æ–ª–∂–Ω–∞ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è** - —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–Ω–∞ –Ω–µ –∏—Å–∫–ª—é—á–µ–Ω–∞ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–∏
2. **–ï—Å–ª–∏ –∫–æ–ª–æ–Ω–∫–∞ –Ω–µ –Ω—É–∂–Ω–∞ –≤ Supabase** - –¥–æ–±–∞–≤—å—Ç–µ –µ—ë –≤ —Å–ø–∏—Å–æ–∫ –∏—Å–∫–ª—é—á–µ–Ω–∏–π (–∫–∞–∫ —Å–µ–π—á–∞—Å —Å `contractor_id`)

---

## –ü—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞

### 1. –î–æ–±–∞–≤–∏–ª–∏ –Ω–æ–≤—É—é –∫–æ–ª–æ–Ω–∫—É –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –ë–î

–í –≤–∞—à–µ–º –∫–æ–¥–µ Electron:
```javascript
db.exec('ALTER TABLE tasks ADD COLUMN new_field TEXT');
```

### 2. –î–æ–±–∞–≤–∏–ª–∏ –∫–æ–ª–æ–Ω–∫—É –≤ Supabase

–í Supabase SQL Editor:
```sql
ALTER TABLE tasks ADD COLUMN new_field TEXT;
```

### 3. –û–±–Ω–æ–≤–∏–ª–∏ —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏

–í `scripts/migrate-to-supabase.mjs` - —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `new_field` –Ω–µ –∏—Å–∫–ª—é—á–∞–µ—Ç—Å—è:
```javascript
const { contractor_id, paused_from_column_id, ...taskCleaned } = task;
// new_field –ù–ï –∏—Å–∫–ª—é—á–∞–µ—Ç—Å—è, –ø–æ—ç—Ç–æ–º—É –±—É–¥–µ—Ç –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
```

### 4. –ó–∞–ø—É—Å—Ç–∏–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö

```bash
./run-migration.sh
```

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

‚úÖ **–î–µ–ª–∞–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∞—Ç–æ–º–∞—Ä–Ω–æ** - –æ–¥–∏–Ω —Ñ–∞–π–ª = –æ–¥–Ω–æ –ª–æ–≥–∏—á–µ—Å–∫–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ  
‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ IF NOT EXISTS** - —á—Ç–æ–±—ã –º–∏–≥—Ä–∞—Ü–∏—é –º–æ–∂–Ω–æ –±—ã–ª–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑  
‚úÖ **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏** - —Å–Ω–∞—á–∞–ª–∞ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –ë–î, –ø–æ—Ç–æ–º –Ω–∞ production  
‚úÖ **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä—É–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–æ–º–µ—Ä–∞/–¥–∞—Ç—ã –≤ –∏–º–µ–Ω–∞—Ö —Ñ–∞–π–ª–æ–≤  

---

## –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

–ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å—Ö–µ–º—ã SQLite –∏ Supabase
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç SQL –º–∏–≥—Ä–∞—Ü–∏–∏
- –ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é

–ù–æ –ø–æ–∫–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä—É—á–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π —á–µ—Ä–µ–∑ SQL Editor.
